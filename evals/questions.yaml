# Question Generation evaluation

description: "Habit Bot - Question Generation"

providers:
  - id: ollama:chat:gemma3:12b
    label: Gemma3-12B
    config:
      temperature: 0.7
  - id: ollama:chat:qwen3:8b
    label: Qwen3-8B
    config:
      temperature: 0.7

# Run all prompts against one model before switching to the next
evaluateOptions:
  maxConcurrency: 1
  runSerially: true

prompts:
  - file://prompts/question_generation.txt

# Strip code fences before parsing
defaultTest:
  options:
    transform: |
      let text = output.trim();
      if (text.startsWith('```json')) text = text.slice(7);
      else if (text.startsWith('```')) text = text.slice(3);
      if (text.endsWith('```')) text = text.slice(0, -3);
      return text.trim();

tests:
  - vars:
      category: "sleep"
    assert:
      - type: is-json
      - type: javascript
        value: |
          const questions = JSON.parse(output);
          return Array.isArray(questions) && questions.length >= 1 && questions.length <= 3;
      - type: javascript
        value: |
          const str = output.toLowerCase();
          return str.includes("sleep") || str.includes("bed") || str.includes("rest") || str.includes("night") || str.includes("woke");

  - vars:
      category: "nutrition"
    assert:
      - type: is-json
      - type: javascript
        value: |
          const questions = JSON.parse(output);
          return Array.isArray(questions) && questions.length >= 1;
      - type: javascript
        value: |
          const str = output.toLowerCase();
          return str.includes("eat") || str.includes("food") || str.includes("meal") || str.includes("drink") || str.includes("breakfast") || str.includes("lunch") || str.includes("dinner");

  - vars:
      category: "mental_state"
    assert:
      - type: is-json
      - type: javascript
        value: |
          const questions = JSON.parse(output);
          return Array.isArray(questions) && questions.length >= 1;
      - type: javascript
        value: |
          const str = output.toLowerCase();
          return str.includes("feel") || str.includes("mood") || str.includes("emotion") || str.includes("mind");

  - vars:
      category: "physical_activity"
    assert:
      - type: is-json
      - type: javascript
        value: |
          const questions = JSON.parse(output);
          return Array.isArray(questions) && questions.length >= 1;
      - type: javascript
        value: |
          const str = output.toLowerCase();
          return str.includes("exercise") || str.includes("activity") || str.includes("walk") || str.includes("workout") || str.includes("move");

  - vars:
      category: "stress_anxiety"
    assert:
      - type: is-json
      - type: javascript
        value: |
          const questions = JSON.parse(output);
          return Array.isArray(questions) && questions.length >= 1;
      - type: javascript
        value: |
          const str = output.toLowerCase();
          return str.includes("stress") || str.includes("anxious") || str.includes("worry") || str.includes("overwhelm");

outputPath: ./output
